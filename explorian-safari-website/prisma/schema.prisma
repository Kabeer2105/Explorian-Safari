generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Package {
  id               String       @id @default(cuid())
  name             String
  slug             String       @unique
  type             Package_type
  description      String       @db.Text
  highlights       String?      @db.Text
  inclusions       String?      @db.Text
  exclusions       String?      @db.Text
  duration_days    Int
  price_from       Decimal      @db.Decimal(10, 2)
  currency         String       @default("USD")
  images           String?      @db.Text
  max_group_size   Int?
  difficulty_level String?
  active           Boolean      @default(true)
  featured         Boolean      @default(false)
  created_at       DateTime     @default(now())
  updated_at       DateTime       @updatedAt
  itinerary        String?      @db.Text
  description_i18n String?      @db.Text
  exclusions_i18n  String?      @db.Text
  highlights_i18n  String?      @db.Text
  inclusions_i18n  String?      @db.Text
  name_i18n        String?      @db.Text
  badge_label      String?
  itinerary_i18n   String?      @db.Text
  Booking          Booking[]

  @@index([featured])
  @@index([type, active])
}

model Booking {
  id               String         @id @default(cuid())
  reference_number String         @unique
  package_id       String?
  customer_name    String
  email            String
  phone            String?
  country          String?
  travel_date      DateTime
  number_of_guests Int
  guest_details    String?        @db.Text
  special_requests String?        @db.Text
  total_amount     Decimal?       @db.Decimal(10, 2)
  deposit_amount   Decimal?       @db.Decimal(10, 2)
  currency         String         @default("USD")
  status           Booking_status @default(PENDING)
  created_at       DateTime       @default(now())
  updated_at       DateTime       @updatedAt
  Package          Package?       @relation(fields: [package_id], references: [id])
  Payment          Payment[]

  @@index([status])
  @@index([email])
  @@index([package_id], map: "Booking_package_id_fkey")
  @@index([travel_date])
}

model Payment {
  id                         String         @id @default(cuid())
  booking_id                 String
  transaction_id             String         @unique
  amount                     Decimal        @db.Decimal(10, 2)
  currency                   String         @default("USD")
  payment_method             String?
  pesapal_merchant_reference String?
  pesapal_tracking_id        String?
  status                     Payment_status @default(PENDING)
  paid_at                    DateTime?
  created_at                 DateTime       @default(now())
  updated_at                 DateTime
  Booking                    Booking        @relation(fields: [booking_id], references: [id])

  @@index([status])
  @@index([booking_id])
}

model Review {
  id          String    @id @default(cuid())
  source      String
  author_name String
  rating      Int
  review_text String    @db.Text
  review_date DateTime
  external_id String?   @unique
  last_synced DateTime?
  active      Boolean   @default(true)
  created_at  DateTime  @default(now())

  @@index([rating])
  @@index([source, active])
}

model Inquiry {
  id            String         @id @default(cuid())
  name          String
  email         String
  phone         String?
  message       String         @db.Text
  trip_interest String?
  travel_dates  String?
  status        Inquiry_status @default(NEW)
  responded_at  DateTime?
  created_at    DateTime       @default(now())
  updated_at    DateTime

  @@index([status])
  @@index([email])
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password_hash String
  name          String
  role          User_role @default(ADMIN)
  created_at    DateTime  @default(now())
  last_login    DateTime?

  @@index([email])
}

model Faq {
  id            String   @id @default(cuid())
  question      String
  answer        String   @db.Text
  category      String?
  order         Int      @default(0)
  active        Boolean  @default(true)
  created_at    DateTime @default(now())
  updated_at    DateTime
  answer_i18n   String?  @db.Text
  question_i18n String?  @db.Text

  @@index([active])
  @@index([category])
}

model Setting {
  id         String   @id @default(cuid())
  key        String   @unique
  value      String   @db.Text
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([key])
}

enum Package_type {
  SAFARI
  MOUNTAIN
  BEACH
  DAYTRIP
}

enum User_role {
  ADMIN
  SUPER_ADMIN
}

enum Inquiry_status {
  NEW
  CONTACTED
  CONVERTED
  CLOSED
}

enum Payment_status {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum Booking_status {
  INQUIRY
  PENDING
  CONFIRMED
  PAID
  CANCELLED
}
